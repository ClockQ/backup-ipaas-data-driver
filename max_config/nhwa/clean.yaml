name: panel
reference: com.pharbers.ipaas.data.driver.api.job.PhBaseJob
factory: com.pharbers.ipaas.data.driver.api.factory.PhJobFactory
actions:
- name: readCpaFile
  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
  opers:
  - name: loadCpaFromParquet
    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
    reference: com.pharbers.ipaas.data.driver.operators.PhReadOperator
    args:
      path: hdfs:///data/nhwa/pha_config_repository1809/Nhwa_201809_CPA_20181126.csv
  - name: hospIdCastInt
    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
    reference: com.pharbers.ipaas.data.driver.operators.addColumn
    args:
      inDFName: df
      newColName: HOSP_ID
    plugin:
      name: castInt
      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
      args:
        exprString: cast(HOSP_ID as int)
#
#- name: readHospitalFile
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.PhReadParquetOperator
#    args:
#      path: hdfs:///repository/hosp_dis_max
#
#- name: readProductFile
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.PhReadParquetOperator
#    args:
#      path: hdfs:///repository/prod_etc_dis_max/5ca069bceeefcc012918ec72
#  - name: concant
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: min2
#    plugin:
#      name: concatMin2
#      reference: com.pharbers.ipaas.data.driver.plugin.ConcatStrPlugin
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      args:
#        columns: ETC_PRODUCT_NAME,ETC_DOSAGE_NAME,ETC_PACKAGE_DES,ETC_PACKAGE_NUMBER,ETC_CORP_NAME
#        dilimiter: ""
#  - name: productSelect
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.select
#    args:
#      inDFName: df
#      selects: DEV_PRODUCT_ID as PRODUCT_ID#regexp_replace(min2, " ", "") as min2
#
#- name: readPhaFile
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.PhReadParquetOperator
#    args:
#      path: hdfs:///repository/pha
#
#- name: readProductMatchFile
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.PhReadOperator
#    args:
#      path: hdfs:///data/nhwa/pha_config_repository1809/Nhwa_ProductMatchTable_20181126.csv
#  - name: productMatchSelect
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.select
#    args:
#      inDFName: df
#      selects: regexp_replace(MIN_PRODUCT_UNIT, " ", "") as MIN_PRODUCT_UNIT#regexp_replace(MIN_PRODUCT_UNIT_STANDARD, " ", "") as MIN_PRODUCT_UNIT_STANDARD
#
#- name: distinctHosp
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name: hospitalSelect
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.select
#    args:
#      inDFName: readHospitalFile
#      selects: HOSPITAL_ID#PHA_HOSP_ID
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.distinctByKey
#    args:
#      inDFName: df
#      keys: PHA_HOSP_ID
#
#- name: distinctPha
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name: phaSelect
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.select
#    args:
#      inDFName: readPhaFile
#      selects: CPA#PHA_ID_NEW
#  - name: hospIdCastInt
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: CPA
#    plugin:
#      name: castInt
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: cast(CPA as int)
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.distinctByKey
#    args:
#      inDFName: df
#      keys: CPA
#
#- name: cpaMatchHosp
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name: joinPha
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.JoinOperator
#    args:
#      inDFName: readCpaFile
#      joinDFName: distinctPha
#      joinExpr: HOSP_ID = CPA
#      joinType: left
#  - name: joinHosp
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.JoinOperator
#    args:
#      inDFName: df
#      joinDFName: distinctHosp
#      joinExpr: PHA_ID_NEW = PHA_HOSP_ID
#      joinType: left
#  - name: addHospId
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: HOSPITAL_ID
#    plugin:
#      name: fillHospId
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: case when HOSPITAL_ID is not null then HOSPITAL_ID else concat("other", HOSP_ID) end
#
#- name: cpaMatchProduct
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name: concant
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: cpaMatchHosp
#      newColName: min1
#    plugin:
#      name: concatMin1
#      reference: com.pharbers.ipaas.data.driver.plugin.ConcatStrPlugin
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      args:
#        columns: PRODUCT_NAME,DOSAGE,PACK_DES,PACK_NUMBER,CORP_NAME
#        dilimiter: ""
#  - name: regexpReplaceMin1
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: min1
#    plugin:
#      name: regexpReplaceMin1
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: regexp_replace(min1, " ", "")
#  - name: joinProductMatch
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.JoinOperator
#    args:
#      inDFName: df
#      joinDFName: readProductMatchFile
#      joinExpr: min1 = MIN_PRODUCT_UNIT
#      joinType: left
#  - name: joinProduct
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.JoinOperator
#    args:
#      inDFName: df
#      joinDFName: readProductFile
#      joinExpr: MIN_PRODUCT_UNIT_STANDARD = min2
#      joinType: left
#
#- name: clean
#  reference: com.pharbers.ipaas.data.driver.api.job.PhBaseAction
#  factory: com.pharbers.ipaas.data.driver.api.factory.PhActionFactory
#  args:
#    null: null
#  opers:
#  - name: litCompanyId
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: cpaMatchProduct
#      newColName: COMPANY_ID
#    plugin:
#      name: litCompanyId
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: "'5ca069bceeefcc012918ec72'"
#  - name: litSOURCE
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: SOURCE
#    plugin:
#      name: litSOURCE
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: "'CPA'"
#  - name: litProductNameNote
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: PRODUCT_NAME_NOTE
#    plugin:
#      name: litProductNameNote
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.BaseCalcPlugin
#      args:
#        exprString: "''"
#  - name: addYM
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: YM
#    plugin:
#      name: addYM
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.MergeYM
#  - name:
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.select
#    args:
#      inDFName: df
#      selects: COMPANY_ID#SOURCE#YM#HOSPITAL_ID#PRODUCT_ID#cast(VALUE as double) as SALES#cast(STANDARD_UNIT as double) as UNITS#PRODUCT_NAME_NOTE
#  - name: generateObjectId
#    factory: com.pharbers.ipaas.data.driver.api.factory.PhOperatorFactory
#    reference: com.pharbers.ipaas.data.driver.operators.addColumn
#    args:
#      inDFName: df
#      newColName: _id
#    plugin:
#      name: generateObjectId
#      factory: com.pharbers.ipaas.data.driver.api.factory.PhPluginFactory
#      reference: com.pharbers.ipaas.data.driver.plugin.generateObjectId